problem if you have a line beginning with > or # in a verbatim
section.  these will be stripped out as code.

perhaps better to have a separate program that parses the input
file into code + text, then uses the GHC API to construct a function out
of the code, and finally parses the text with this function.

or, if not using the GHC API, we could simply construct a temporary
file with a lhs program.

possible solution?

jgm@johnsmac:~/src/HeX [503]% cat t.sh
#!/bin/sh
# $1 is source file name, $2 is source contents, $3 is dest file name
sed -e 's/Y/y/g' $2 > $3
echo $4
jgm@johnsmac:~/src/HeX [504]% runghc -F -pgmF=./t.sh -optF=--eek h.txt
--eek
Hi you
jgm@johnsmac:~/src/HeX [505]% 

now we just need, instead of t.sh, something that strips out the
code parts and puts in blank lines.
striphex

Then a target hex file can look like this:

import Blah

main = blah

---

The file starts here.

more text


